+++
date = '2025-12-20T23:08:16+08:00'
draft = true
title = '治思维在 Agent 开发中的应用'
+++

> **把“不可控的大问题”，拆成“可验证的小问题”**
> 这是分治的本质，也是 Agent 能走向工程可靠性的关键。

过去一年，很多团队都在做 Agent。
也几乎在同一时间，大家都遇到了类似的问题：

- 模型能力越强，系统越不可控
- Prompt 越复杂，行为越不可预测
- 任务越大，失败越“莫名其妙”

这并不是模型的问题，而是**系统结构的问题**。

## 一、为什么 Agent 天生需要分治

在传统软件系统中，我们有三件“安全感来源”：

- 需求是相对确定的
- 执行路径是可设计的
- 错误是可枚举的

但 Agent 系统恰恰相反：

- **输入来自开放世界**
- **推理是概率性的，而非逻辑必然**
- **Agent 的行为会反过来改变环境状态**

这意味着一个事实：

> **Agent 的复杂度不是线性的，而是组合爆炸的。**

在这种系统里，如果你把所有认知、规划、执行都压在一个模型里，本质上是在赌一件事：
**“这一次它刚好想对了。”**

而工程系统，不能靠赌。

## 二、分治在 Agent 中的真正目标

这里必须澄清一个常见误解：

> **Agent 里的分治，不是为了更快，而是为了更稳。**

在算法世界里，分治解决的是**计算复杂度问题**；
在 Agent 世界里，分治解决的是**认知不确定性问题**。

它的核心目标只有三个：

1. **缩小单次推理的认知半径**
2. **让中间结果变得可验证**
3. **把错误限制在局部，而不是全局扩散**

一句话总结：

> **分治不是拆步骤，而是拆风险。**

## 三、Agent 分治的四种核心工程模式

这四种模式并不是“技巧”，而是已经在大量 Agent 系统中反复出现的**稳定结构**。

### 1. 计划与执行分离（Plan & Execute）

**问题本质**：
LLM 一边想、一边做时，极容易在中途跑偏，而且跑偏后自己意识不到。

**分治方式**：

- Planner：只负责“要做哪些事”
- Executor：只负责“把事做完”
- Re-planner：在失败或环境变化时重来

这相当于在系统中引入了一个**显式的“思考层”**。

它的价值不在于更聪明，而在于：

> **让系统具备暂停、回滚和重规划的能力**

### 2. 角色解耦（Multi-Agent Role Split）

LLM 对“角色”高度敏感，这是一个非常重要的工程特性。

典型做法是：

- 一个 Agent 负责生成
- 另一个 Agent 负责质疑、审查、找错

例如在代码场景中：

- Developer Agent：只写代码
- Reviewer Agent：只找问题

这不是为了并行，而是为了：

> **用结构化对立，抵消模型的单向偏见**

### 3. 分段式上下文管理（Map → Reduce）

当任务规模上升到「长文档 / 多资料 / 多来源」时，失败往往不是能力不够，而是**上下文被淹没**。

分治方案非常明确：

- Map：局部处理、局部总结
- Reduce：统一整合、再判断

这一步的工程意义在于：

- 上下文可控
- Token 成本可预期
- 中间结果可缓存、可复用

它是 Agent 系统走向规模化的前提。

### 4. 多路径推理与剪枝（Tree of Thoughts）

现实问题往往不存在“唯一正确路径”。

Tree of Thoughts 的核心价值是：

- 允许探索多条可能路径
- 对中间结果进行局部评估
- 主动剪掉低质量分支

这让 Agent 的行为从“押注一次推理”，变成：

> **在多种可能性中，系统性地避免明显错误**

## 四、从 CoT 到 GoT：分治逻辑的自然进化

如果把这些推理方式放在一起看，其实非常清晰：

- **CoT（思维链）**：线性拆解，降低单步认知难度
- **ToT（思维树）**：多路径探索，允许回溯
- **GoT（思维图）**：并行子问题 + 聚合重组

GoT 的关键不在“更复杂”，而在于它第一次做到：

- 并行而不混乱
- 聚合而不丢信息

本质上，这是 **MapReduce 在认知层的实现**。

## 五、分治的代价：为什么“拆了反而更难”

分治不是银弹，尤其在 Agent 系统中。

常见的工程代价包括：

1. **上下文孤岛**
   子 Agent 永远只能看到被压缩后的世界

2. **错误级联与调试困难**
   没有可观测性，就只能“事后尸检”

3. **协调与 Token 成本**
   过度分治会直接拖垮响应时间

4. **状态同步与并发风险**
   Agent 一旦并发，工程问题立刻显现

成熟的系统拼的不是“能不能拆”，而是：

> **拆到哪里刚刚好**

最后，想强调的是：Agent 的本质不是模型，而是结构

> **Agent 不是一种模型形态，而是一种系统架构思想。**

而这套架构思想的核心只有一句话：

- 把认知拆解
- 把不确定性局部化
- 把控制权留在系统中

分治思维不会让 Agent 立刻变得更聪明，
但它会让系统 **不那么容易犯致命错误**。

而在真实世界里，这往往比“聪明”重要得多。
